# Face Recognition using Tensorflow
This is a repo about how we train our model, which refers to resource [Face Recognition using tensorflow](https://github.com/davidsandberg/facenet#face-recognition-using-tensorflow-).

## Pretrained models
| Model name | LFW accuracy | Training dataset | Architecture |
|--------|--------|--------|--------|
| [20180408-102900](https://drive.google.com/open?id=1R77HmFADxe87GmoLwzfgMu_HY0IhcyBz) | 0.9905 | CASIA-WebFace | [Inception ResNet V1](https://github.com/davidsandberg/facenet/blob/master/src/models/inception_resnet_v1.py) |
| [20180402-114759](https://drive.google.com/open?id=1EXPBSXwTaqrSC0OhUdXNmKSh9qJUQ55-)| 0.9965 | VGGFace2 | [Inception ResNet V1](https://github.com/davidsandberg/facenet/blob/master/src/models/inception_resnet_v1.py) |

## Inspriation
The code is heavily inspired by the [Facenet](https://github.com/davidsandberg/facenet) implementation.

## Pre-processing
### Face alignment using MTCNN
One face landmark detector that has proven to work well in this setting is the [Multi-task CNN](https://kpzhang93.github.io/MTCNN_face_detection_alignment/index.html). 

#### Set the python paths
Set the environment variable `PYTHONPATH` to point to the `src` directory of the cloned repo. This is typically done something like this

`export PYTHONPATH=[...]/facenet/src`

where [...] should be replaced with the direcotry where cloned facenet  repo resides.

#### Prepare training dataset(s)

###### Dataset structure

Is assumed that the training dataset is arranged as below, i.e. where each class a sub-directory containing the training examples belonging to that class.

```
Aaron_Eckhart
    Aaron_Eckhart_0001.jpg

Aaron_Guiel
    Aaron_Guiel_0001.jpg

Aaron_Patterson
    Aaron_Patterson_0001.jpg

Aaron_Peirsol
    Aaron_Peirsol_0001.jpg
    Aaron_Peirsol_0002.jpg
    Aaron_Peirsol_0003.jpg
    Aaron_Peirsol_0004.jpg
    ...
```

##### Face alignment
For face alignment it is recommended to use [MTCNN](https://github.com/kpzhang93/MTCNN_face_detection_alignment) which has been proven to give good performance for alignment fo train/test sets.In addition, a matlab script to align a dataset using this implementation can be foud here.

To simplify the usage of this project a python/tensorflow implementation of MTCNN is provided. This implementation does not have any other external dependencies than Tensorflow and the runtime on LFW is similar to the matlab implementation.

```
python src/align/align_dataset_mtcnn.py \
~/datasets/casia/CASIA-maxpy-clean/ \
~/datasets/casia/casia_maxpy_mtcnnpy_182 \
--image_size 182 \
--margin 44
```

The face thumbnails generated by the above command are 182x182 pixels. The input to the Inception-ResNet-v1 model is 160x160 pixels giving some margin to use a random crop. For the experiments that has been performed with the Inception-ResNet-v1 model an margin additional margin of 32 pixels has been used. The reason for this additional widen the bounding box given by the face alignment and give the CNN some additional contextual information. However, the setting of this parameter has not yet been studied and it could very well be that other margins results in better performance.





